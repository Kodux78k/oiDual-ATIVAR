<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>Dual Infodose — KOBLLUX OS</title>
  <meta name="theme-color" content="#050714"/>
  <link rel="manifest" href="./manifest.json">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<!-- Apple Touch Icon -->
<link rel="apple-touch-icon" sizes="180x180" href="./icon-192.png">
<script> if ('serviceWorker' in navigator) { navigator.serviceWorker.register('./sw.js') .then(() => console.log('Service Worker Registered')); } </script>
<!-- Ícone 192x192 -->
<link rel="icon" type="image/png" sizes="192x192" href="./icon-192.png">
 <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=JetBrains+Mono:wght@500;700&family=Montserrat:wght@900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        :root {
            --bg-dark: #020408;
            --accent-1: #4fd4ff;
            --accent-2: #9d00ff;
            --glass: rgba(10, 15, 25, 0.85);
            --glass-border: rgba(255, 255, 255, 0.08);
            --text: #f0f0f0;
            --ease: cubic-bezier(0.19, 1, 0.22, 1);
            --grad: linear-gradient(135deg, var(--accent-1), var(--accent-2));
        }

        [data-theme="madrugada"] { --accent-1: #3b82f6; --accent-2: #1d4ed8; --bg-dark: #010206; }
        [data-theme="manha"] { --accent-1: #f59e0b; --accent-2: #ef4444; --bg-dark: #0f0a05; }
        [data-theme="tarde"] { --accent-1: #10b981; --accent-2: #3b82f6; --bg-dark: #060a0f; }
        [data-theme="noite"] { --accent-1: #8b5cf6; --accent-2: #ec4899; --bg-dark: #05020a; }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body {
            background-color: var(--bg-dark);
            color: var(--text);
            font-family: 'Outfit', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            transition: background-color 1s var(--ease);
        }

        .ambient-glow { position: fixed; inset: 0; z-index: -1; pointer-events: none; }
        .blob {
            position: absolute; width: 80vw; height: 80vw; border-radius: 50%;
            filter: blur(100px); opacity: 0.12;
            animation: float 25s infinite alternate ease-in-out;
            background: var(--grad);
        }

        @keyframes float {
            0% { transform: translate(-10%, -10%) rotate(0deg); }
            100% { transform: translate(20%, 20%) rotate(90deg); }
        }

        .glass {
            background: var(--glass);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border: 1px solid var(--glass-border);
        }

        #splash {
            position: fixed; inset: 0; z-index: 2000;
            background: #000; display: flex; align-items: center; justify-content: center;
        }
        
        #manifesto-overlay {
            position: fixed; inset: 0; z-index: 2100;
            background: #000; display: none;
            flex-direction: column; align-items: center; justify-content: center;
            font-family: 'JetBrains Mono', monospace; padding: 20px;
        }

        .fractal-canvas { 
            font-family: 'JetBrains Mono', monospace; 
            line-height: 1; color: var(--accent-1); 
            text-shadow: 0 0 10px var(--accent-1);
        }

        .collapsible-container { overflow: hidden; margin-bottom: 1.5rem; transition: all 0.5s var(--ease); }
        .collapsible-trigger { cursor: pointer; padding: 24px 30px; display: flex; justify-content: space-between; align-items: center; }
        .collapsible-body { max-height: 0; opacity: 0; transition: all 0.5s var(--ease); padding: 0 30px; }
        .is-open .collapsible-body { max-height: 2000px; opacity: 1; padding-bottom: 30px; }
        .chev { transition: transform 0.4s var(--ease); opacity: 0.3; }
        .is-open .chev { transform: rotate(180deg); opacity: 1; color: var(--accent-1); }

        .btn-dual {
            background: var(--grad);
            color: #000; font-weight: 800; border-radius: 16px;
            padding: 14px; width: 100%; transition: all 0.3s var(--ease);
            text-transform: uppercase; letter-spacing: 1px; font-size: 10px;
            display: flex; align-items: center; justify-content: center; gap: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .btn-dual:hover { transform: translateY(-2px); filter: brightness(1.1); }
        .btn-dual:active { transform: scale(0.96); }
        .btn-outline { background: rgba(255,255,255,0.03); color: white; border: 1px solid rgba(255,255,255,0.1); box-shadow: none; }

        .input-dual {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 16px; padding: 16px; width: 100%; color: inherit;
            transition: all 0.3s;
        }
        .input-dual:focus { border-color: var(--accent-1); background: rgba(255,255,255,0.06); }

        .sub-card {
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 24px; margin-top: 10px;
        }

        #toast {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(100px);
            background: var(--glass); backdrop-filter: blur(20px);
            padding: 12px 24px; border-radius: 50px; font-weight: 800; font-size: 10px;
            color: var(--accent-1); text-transform: uppercase; letter-spacing: 2px;
            transition: 0.5s var(--ease); z-index: 3000; border: 1px solid var(--accent-1);
        }
        #toast.active { transform: translateX(-50%) translateY(0); }

        .debate-bubble {
            border-left: 2px solid var(--accent-1);
            padding-left: 12px; margin-bottom: 12px;
            animation: slideIn 0.3s var(--ease) forwards;
        }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
    </style>
</head>
<body class="p-4 md:p-12">

    <div class="ambient-glow">
        <div class="blob"></div>
    </div>

    <!-- INITIAL SPLASH -->
    <div id="splash">
        <div class="max-w-xs w-full text-center px-6">
            <div class="mb-8 flex justify-center">
                <div class="w-20 h-20 glass rounded-[28px] flex items-center justify-center border-accent-1/20 border shadow-2xl">
                    <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" class="text-accent-1">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                    </svg>
                </div>
            </div>
            <h2 class="text-3xl font-black mb-2 tracking-tighter uppercase" style="background:var(--grad); -webkit-background-clip:text; -webkit-text-fill-color:transparent;">Infodose</h2>
            <p class="text-[9px] font-black tracking-[0.4em] text-white/20 mb-8 uppercase">Neural Interface v2.4.2</p>
            
            <input id="user-input" type="text" placeholder="SEU NOME" class="input-dual mb-4 text-center font-bold tracking-widest text-xs uppercase" maxlength="12" />
            <button onclick="app.initActivation()" class="btn-dual">Sincronizar Hash</button>
        </div>
    </div>

    <!-- FRACTAL MANIFESTO OVERLAY -->
    <div id="manifesto-overlay">
        <div id="fractal-art" class="fractal-canvas text-[6px] md:text-[8px] mb-8 leading-[0.8] tracking-tighter"></div>
        <div id="manifesto-text" class="text-[10px] text-white/40 uppercase tracking-[0.4em] text-center font-mono">CALIBRANDO PULSO...</div>
    </div>

    <!-- MAIN APP CONTENT -->
    <div id="main-content" class="max-w-3xl mx-auto opacity-0 translate-y-8 transition-all duration-1000 hidden pb-24">
        
        <header class="flex justify-between items-center mb-8 px-2">
            <div class="flex items-center gap-4">
                <div class="w-8 h-8 rounded-full border border-accent-1/20 flex items-center justify-center overflow-hidden">
                    <div id="header-fractal" class="text-[3px] fractal-canvas"></div>
                </div>
                <span class="text-[10px] font-black tracking-[0.5em] text-white/20 uppercase">Dual.Infodose // Masterclass</span>
            </div>
            <div id="clock" class="font-mono text-xl font-bold opacity-40">00:00</div>
        </header>

        <!-- CARD PRINCIPAL: FLUXO E CONFIG -->
        <section id="user-stack" class="glass rounded-[40px] collapsible-container border border-white/5 is-open">
            <div class="collapsible-trigger" onclick="app.toggle('user-stack')">
                <div class="flex flex-col">
                    <div class="flex items-center gap-2 mb-1">
                        <div class="w-2 h-2 rounded-full bg-accent-1 shadow-[0_0_10px_var(--accent-1)]"></div>
                        <span id="phase-label" class="text-[9px] font-black text-white/40 uppercase tracking-widest">Protocolo Ativo</span>
                    </div>
                    <h1 class="text-2xl font-black tracking-tighter uppercase" style="font-family:'Montserrat'">
                        <span id="display-name" style="background:var(--grad); -webkit-background-clip:text; -webkit-text-fill-color:transparent;">USER</span> INFODOSE
                    </h1>
                </div>
                <svg class="chev w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="6 9 12 15 18 9"></polyline></svg>
            </div>
            
            <div class="collapsible-body">
                <!-- SUB-CARD: PERSONALIZAÇÃO -->
                <div class="sub-card p-6 mb-4">
                    <div class="flex items-center justify-between mb-4">
                        <span class="text-[10px] font-black uppercase tracking-widest text-accent-1">Fluxo de Ativação</span>
                        <div class="flex gap-2">
                            <button onclick="app.toggleFractalAnim()" class="p-2 bg-white/5 rounded-lg text-white/40 hover:text-white" id="btn-play">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
                            </button>
                        </div>
                    </div>

                    <div id="flow-content" class="space-y-4">
                        <div class="grid grid-cols-1 gap-3">
                            <button onclick="app.startFlow('personalize')" class="btn-dual text-[10px]">Personalizar Assistente</button>
                            <button onclick="app.startFlow('archetypes')" class="btn-dual btn-outline text-[10px]">12 Arquétipos</button>
                        </div>
                    </div>
                </div>

                <!-- SUB-CARD: TEMA E ESTÉTICA -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="p-6 sub-card">
                        <label class="text-[9px] font-black text-white/20 uppercase tracking-widest block mb-4">Cor & Movimento</label>
                        <div class="flex gap-2 mb-4">
                            <div onclick="app.setTheme('madrugada')" class="w-6 h-6 rounded-full bg-blue-600 cursor-pointer border-2 border-transparent hover:border-white"></div>
                            <div onclick="app.setTheme('manha')" class="w-6 h-6 rounded-full bg-amber-500 cursor-pointer border-2 border-transparent hover:border-white"></div>
                            <div onclick="app.setTheme('tarde')" class="w-6 h-6 rounded-full bg-emerald-500 cursor-pointer border-2 border-transparent hover:border-white"></div>
                            <div onclick="app.setTheme('noite')" class="w-6 h-6 rounded-full bg-purple-600 cursor-pointer border-2 border-transparent hover:border-white"></div>
                        </div>
                        <select id="motion-select" class="input-dual text-[10px] font-bold uppercase py-2">
                            <option value="none">Movimento: Nenhum</option>
                            <option value="low" selected>Movimento: Baixo</option>
                            <option value="med">Movimento: Médio</option>
                            <option value="high">Movimento: Alto</option>
                        </select>
                    </div>
                    <div class="p-6 sub-card flex flex-col justify-center">
                        <span class="text-[9px] font-black text-white/20 uppercase tracking-widest block mb-2">Ações de Fractal</span>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="app.copyFractal()" class="p-3 bg-white/5 rounded-xl text-[9px] uppercase font-bold hover:bg-white/10">Copiar Fractal</button>
                            <button onclick="app.copyFrames()" class="p-3 bg-white/5 rounded-xl text-[9px] uppercase font-bold hover:bg-white/10">Copiar Frames</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- STACK: TRANSFORMER -->
        <section id="transform-stack" class="glass rounded-[35px] collapsible-container border border-white/5">
            <div class="collapsible-trigger" onclick="app.toggle('transform-stack')">
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 bg-white/5 rounded-xl flex items-center justify-center">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
                    </div>
                    <span class="text-xs font-black uppercase tracking-[0.2em]">Painel de Síntese</span>
                </div>
                <svg class="chev w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="6 9 12 15 18 9"></polyline></svg>
            </div>
            <div class="collapsible-body">
                <textarea id="main-input" class="input-dual min-h-[120px] mb-4 font-mono text-xs placeholder:opacity-10 resize-none" placeholder="ENTRADA DE DADOS BRUTOS..."></textarea>
                <div class="flex gap-2">
                    <button onclick="app.process()" class="btn-dual">Sintetizar Dose</button>
                </div>
            </div>
        </section>

        <!-- STACK: DEBATE & LOG -->
        <section id="history-stack" class="glass rounded-[35px] collapsible-container border border-white/5">
            <div class="collapsible-trigger" onclick="app.toggle('history-stack')">
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 bg-white/5 rounded-xl flex items-center justify-center">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 20v-6M9 20v-10M6 20v-4M15 20v-8M18 20v-12"/></svg>
                    </div>
                    <span class="text-xs font-black uppercase tracking-[0.2em]">Fluxo de Memória</span>
                </div>
                <svg class="chev w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="6 9 12 15 18 9"></polyline></svg>
            </div>
            <div class="collapsible-body">
                <div id="output-stream" class="space-y-3">
                    <div class="text-center py-10 opacity-10 text-[10px] font-black uppercase tracking-widest">Aguardando Pulso</div>
                </div>
            </div>
        </section>

    </div>

    <div id="toast">Notificação</div>

    <script>
        const app = (() => {
            const els = {
                splash: document.getElementById('splash'),
                manifesto: document.getElementById('manifesto-overlay'),
                fractalArt: document.getElementById('fractal-art'),
                manifestoText: document.getElementById('manifesto-text'),
                userInput: document.getElementById('user-input'),
                mainContent: document.getElementById('main-content'),
                displayName: document.getElementById('display-name'),
                clock: document.getElementById('clock'),
                toast: document.getElementById('toast'),
                input: document.getElementById('main-input'),
                stream: document.getElementById('output-stream'),
                flow: document.getElementById('flow-content'),
                btnPlay: document.getElementById('btn-play'),
                headerFractal: document.getElementById('header-fractal')
            };

            const state = {
                user: '',
                hash: 0,
                history: [],
                isAnimating: false,
                frame: 0,
                animTimer: null,
                debateActive: false
            };

            const archetypes = [
                { name: "O Criador", pitch: 1.2, rate: 1.1, desc: "Inovação radical e design." },
                { name: "O Mentor", pitch: 0.9, rate: 0.8, desc: "Sabedoria e guia estratégico." },
                { name: "O Explorador", pitch: 1.1, rate: 1.3, desc: "Busca de novos horizontes." },
                { name: "O Guerreiro", pitch: 0.7, rate: 1.0, desc: "Foco, disciplina e execução." },
                { name: "O Mago", pitch: 0.5, rate: 0.7, desc: "Transformação da realidade." },
                { name: "O Amante", pitch: 1.3, rate: 0.9, desc: "Conexão e estética profunda." },
                { name: "O Tolo", pitch: 1.5, rate: 1.4, desc: "Quebra de padrões com humor." },
                { name: "O Cuidador", pitch: 1.0, rate: 0.8, desc: "Suporte e sustentabilidade." },
                { name: "O Governante", pitch: 0.8, rate: 0.9, desc: "Ordem e controle sistêmico." },
                { name: "O Inocente", pitch: 1.4, rate: 1.1, desc: "Simplicidade e otimismo." },
                { name: "O Órfão", pitch: 0.9, rate: 1.0, desc: "Realismo e pertencimento." },
                { name: "O Rebelde", pitch: 0.6, rate: 1.2, desc: "Revolução e mudança drástica." }
            ];

            const generateHash = (str) => {
                let hash = 0;
                for (let i = 0; i < str.length; i++) hash = ((hash << 5) - hash) + str.charCodeAt(i);
                return Math.abs(hash);
            };

            const getFractal = (seed, frame) => {
                const chars = ["+", "-", "F", "[", "]", "X", "Y"];
                const rules = { 
                    X: "F[+X][-X]FX", 
                    Y: "F-X+F" 
                };
                let axiom = (seed % 2 === 0) ? "X" : "Y";
                // L-System light version
                for(let i=0; i<3; i++) {
                    axiom = axiom.split('').map(c => rules[c] || c).join('').substring(0, 50);
                }
                
                let render = "";
                const width = 30;
                for(let y=0; y<15; y++) {
                    for(let x=0; x<width; x++) {
                        const idx = (x + y + frame) % axiom.length;
                        const char = axiom[idx];
                        if (char === 'F') render += "█";
                        else if (char === '+') render += "/";
                        else if (char === '-') render += "\\";
                        else if (char === '[') render += "(";
                        else if (char === ']') render += ")";
                        else render += " ";
                    }
                    render += "\n";
                }
                return render;
            };

            const speak = (txt, archetype = null) => {
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(txt);
                u.lang = 'pt-BR';
                if (archetype) {
                    u.pitch = archetype.pitch;
                    u.rate = archetype.rate;
                } else {
                    u.pitch = 1; u.rate = 1;
                }
                window.speechSynthesis.speak(u);
            };

            return {
                initActivation: () => {
                    state.user = els.userInput.value.trim().toUpperCase() || 'NEBULA';
                    state.hash = generateHash(state.user);
                    els.splash.style.display = 'none';
                    els.manifesto.style.display = 'flex';
                    
                    let count = 0;
                    const interval = setInterval(() => {
                        els.fractalArt.innerText = getFractal(state.hash, count++);
                        els.manifestoText.innerText = `SYNCING HASH: ${state.hash.toString(16)}... ${count * 4}%`;
                        if(count > 25) {
                            clearInterval(interval);
                            app.finalizeActivation();
                        }
                    }, 80);
                },

                finalizeActivation: () => {
                    els.manifesto.style.opacity = '0';
                    setTimeout(() => {
                        els.manifesto.style.display = 'none';
                        els.mainContent.classList.remove('hidden');
                        setTimeout(() => els.mainContent.classList.add('opacity-100', 'translate-y-0'), 50);
                        els.displayName.innerText = state.user;
                        els.headerFractal.innerText = getFractal(state.hash, 0);
                        app.updateTheme('auto');
                        speak(`Ativação concluída, Dual ${state.user}. Qual caminho seguiremos agora?`);
                    }, 500);
                },

                startFlow: (type) => {
                    if (type === 'personalize') {
                        app.renderStep(1, "Escolha uma cor para ancorar sua intenção:", ["Azul Elétrico", "Verde Fractal", "Ouro Solar", "Vácuo Roxo"]);
                    } else {
                        app.renderStep('archetypes_list', "Os 12 Arquétipos estão em prontidão.", ["Ativar Debate", "Listar Resumos"]);
                    }
                },

                renderStep: (id, question, options) => {
                    let html = `<p class="text-[10px] font-black uppercase tracking-[0.3em] text-accent-1 mb-4 animate-pulse">${question}</p>`;
                    html += `<div class="grid grid-cols-2 gap-2">`;
                    options.forEach(opt => {
                        html += `<button onclick="app.handleFlow('${id}', '${opt}')" class="btn-dual !py-3 !text-[9px] btn-outline">${opt}</button>`;
                    });
                    html += `</div>`;
                    els.flow.innerHTML = html;
                    speak(question);
                },

                handleFlow: (stepId, value) => {
                    if (stepId === 1) {
                        app.renderStep(2, "Nível de movimento desejado no fluxo:", ["Baixo", "Médio", "Alto"]);
                    } else if (stepId === 2) {
                        app.renderStep(3, "Elemento primordial de hoje:", ["Fogo", "Água", "Terra", "Madeira", "Metal"]);
                    } else if (stepId === 3) {
                        const arch = archetypes[state.hash % archetypes.length];
                        els.flow.innerHTML = `
                            <div class="text-center p-4">
                                <p class="text-[9px] font-black text-white/20 uppercase mb-2">Sincronização Final</p>
                                <p class="text-lg font-black text-accent-1 uppercase mb-4">${arch.name}</p>
                                <button onclick="location.reload()" class="btn-dual !w-auto mx-auto !px-8">Reiniciar Fluxo</button>
                            </div>
                        `;
                        speak(`Personalização finalizada. Seu perfil ressoa com ${arch.name}.`);
                    } else if (stepId === 'archetypes_list') {
                        if (value === "Ativar Debate") app.runDebate();
                        else {
                            els.flow.innerHTML = `<div class="grid grid-cols-2 gap-2">` + 
                                archetypes.map(a => `<div class="p-2 border border-white/5 rounded-lg text-[8px] uppercase font-bold">${a.name}</div>`).join('') + 
                                `</div><button onclick="app.startFlow('archetypes')" class="btn-dual mt-2 btn-outline">Voltar</button>`;
                        }
                    }
                },

                runDebate: () => {
                    state.debateActive = true;
                    els.flow.innerHTML = `<div id="debate-ui" class="max-h-[200px] overflow-y-auto text-[10px] space-y-2 mb-4"></div>
                                         <button onclick="app.stopDebate()" class="btn-dual btn-outline">Encerrar Debate</button>`;
                    const debateUi = document.getElementById('debate-ui');
                    
                    const lines = [
                        { a: archetypes[4], t: "A realidade é apenas um código que podemos reescrever." }, // Mago
                        { a: archetypes[3], t: "De nada serve o código se não houver disciplina para executá-lo!" }, // Guerreiro
                        { a: archetypes[1], t: "Paciência. A estratégia precede a ação." }, // Mentor
                        { a: archetypes[11], t: "Por que seguir as regras se podemos quebrá-las agora?" } // Rebelde
                    ];

                    let i = 0;
                    const nextLine = () => {
                        if (!state.debateActive || i >= lines.length) return;
                        const line = lines[i];
                        const div = document.createElement('div');
                        div.className = "debate-bubble";
                        div.innerHTML = `<span class="font-black text-accent-1">${line.a.name}:</span> ${line.t}`;
                        debateUi.appendChild(div);
                        debateUi.scrollTop = debateUi.scrollHeight;
                        speak(line.t, line.a);
                        i++;
                        setTimeout(nextLine, 4000);
                    };
                    nextLine();
                },

                stopDebate: () => {
                    state.debateActive = false;
                    window.speechSynthesis.cancel();
                    app.startFlow('archetypes');
                },

                toggleFractalAnim: () => {
                    state.isAnimating = !state.isAnimating;
                    els.btnPlay.innerHTML = state.isAnimating ? 
                        `<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>` :
                        `<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>`;
                    
                    if (state.isAnimating) {
                        const loop = () => {
                            if(!state.isAnimating) return;
                            state.frame++;
                            els.headerFractal.innerText = getFractal(state.hash, state.frame);
                            state.animTimer = setTimeout(loop, 100);
                        };
                        loop();
                    } else {
                        clearTimeout(state.animTimer);
                    }
                },

                copyFractal: () => {
                    const text = getFractal(state.hash, state.frame);
                    const el = document.createElement('textarea');
                    el.value = text;
                    document.body.appendChild(el);
                    el.select();
                    document.execCommand('copy');
                    document.body.removeChild(el);
                    app.notify("Fractal Copiado");
                },

                copyFrames: () => {
                    let frames = "--- DUAL FRAMES ---\n";
                    for(let i=0; i<5; i++) frames += getFractal(state.hash, i*5) + "\n---\n";
                    const el = document.createElement('textarea');
                    el.value = frames;
                    document.body.appendChild(el);
                    el.select();
                    document.execCommand('copy');
                    document.body.removeChild(el);
                    app.notify("Frames Copiados");
                },

                setTheme: (mode) => {
                    document.documentElement.setAttribute('data-theme', mode);
                    app.notify(`Ciclo: ${mode}`);
                },

                updateTheme: (mode) => {
                    const hour = new Date().getHours();
                    let current = mode;
                    if(mode === 'auto') {
                        if (hour < 6) current = 'madrugada';
                        else if (hour < 12) current = 'manha';
                        else if (hour < 18) current = 'tarde';
                        else current = 'noite';
                    }
                    app.setTheme(current);
                },

                toggle: (id) => document.getElementById(id).classList.toggle('is-open'),

                process: () => {
                    const val = els.input.value.trim();
                    if(!val) return;
                    const entry = { content: val, time: new Date().toLocaleTimeString() };
                    state.history.unshift(entry);
                    els.input.value = '';
                    app.renderHistory();
                    app.notify("Sintetizado");
                },

                renderHistory: () => {
                    els.stream.innerHTML = state.history.map(h => `
                        <div class="p-5 sub-card flex flex-col gap-2">
                            <div class="flex justify-between items-start opacity-30">
                                <span class="text-[8px] font-black uppercase tracking-widest">Hash Log</span>
                                <span class="text-[8px] font-mono">${h.time}</span>
                            </div>
                            <p class="text-[11px] font-medium leading-relaxed">${h.content}</p>
                        </div>
                    `).join('');
                },

                notify: (msg) => {
                    els.toast.innerText = msg;
                    els.toast.classList.add('active');
                    setTimeout(() => els.toast.classList.remove('active'), 2000);
                }
            };
        })();

        setInterval(() => {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString('pt-BR', {hour:'2-digit', minute:'2-digit'});
        }, 1000);
    </script>
</body>
</html>
